- name: Install Java runtime for Selenium
  apt: pkg=default-jre state=present

- name: Install xvfb for headless testing
  apt: pkg=xvfb state=present

- name: Download Selenium server
  get_url:
    url=http://selenium-release.storage.googleapis.com/3.8/selenium-server-standalone-3.8.1.jar
    dest=/usr/local/lib/selenium-server-standalone.jar
  notify: Restart Selenium

- name: Add selenium user
  user:
    name=selenium
    system=yes
    uid=2345

- name: Install browsers
  action: apt pkg={{item}} state=present
  with_items:
    - firefox-esr
    - chromium

- name: Selenium launcher script
  copy:
    src=usr/local/lib/selenium-server.sh
    dest=/usr/local/lib/selenium-server.sh
    owner=selenium
    group=selenium
    mode=0744
  notify: Restart Selenium

- name: Selenium systemd service
  copy:
    src=etc/systemd/system/selenium.service
    dest=/etc/systemd/system/selenium.service
  notify: Restart Selenium

- name: Xvbf upstart script
  copy: src=xvbf.upstart dest=/etc/init/xvbf.conf
  notify: Restart Xvbf

- name: Reload daemons
  command: systemctl daemon-reload

- name: Enable the Selenium service
  service:
    name=selenium.service
    enabled=yes
  notify: Restart Selenium
